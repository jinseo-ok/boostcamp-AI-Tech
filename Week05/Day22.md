# Week05 - Graph

## [Day 22] - 페이지랭크 & 전파 모델

### 1. 검색 엔진에서의 그래프 활용

이번 강의에서는 페이지랭크, PageRank 알고리즘에 대해 배웁니다.

인터넷에는 인터넷 페이지가 무수히 많습니다. 그리고 네이버, 구글 등의 검색엔진에서는 키워드에 대한 적합한 결과를 페이지로 보여주게 됩니다. 검색엔진이 결과를 보여주고 우선순위를 결정하는 방법은 단순하지 않습니다.

이번 강의에서는 구굴의 검색 알고리즘인 페이지랭크 알고리즘을 배우게 됩니다. 그리고 페이지랭크 알고리즘에서 발생할 수 있는 문제점과 이를 해결할 수 있는 알고리즘을 배우게 됩니다.

#### 1) 웹과 그래프

웹은 **웹페이지**와 **하이퍼링크**로 구성된 **거대한 방향 그래프**입니다. 즉, 웹페이지는 정점에 해당하며 웹페이지가 포함하는 하이퍼링크는 해당 웹페이지에서 다음 웹페이지로 향하는 간선에 해당합니다. 이 때, 웹페이지는 추가적으로 키워드 정보를 포함하고 있습니다.

웹의 규모가 커짐에 따라 사용자에게 웹페이지를 보여주는 방식의 변화가 필요했습니다. 첫번째 방법으로는 웹페이지의 디렉토리를 설정하여 카테고리화로 정리하는 것이었습니다. 하지만 웹페이지 자체가 무한정으로 증가하다보니 카테고리 구분이 모호한 경우가 발생하였고 단순히 분류하는 문제가 효율성을 불러올 수 없었습니다. 두번째는 키워드에 따른 웹페이지를 출력하는 방법입니다. 사용자가 입력한 키워드에 해당하는 결과물을 보여주는 방법이지만 페이지 노출을 위해 악의적으로 키워드를 삽입한 경우에 예상치 못한 결과가 나올 수 있습니다.

그렇기 때문에 웹의 규모가 계속해서 폭증하고 있는 상황에서, 사용자 키워드와 관련성이 높고 신뢰할 수 있는 웹페이지를 찾는 알고리즘이 요구되었습니다.

#### 2) 페이지랭크

구글의 창업자인 래리 페이지와 세르게이 브린은 ***The PageRank Citation Ranking: Bringing Order to the Web*** 이라는 논문을 통해 사용자의 키워드와 관련성이 높고 신뢰할 수 있는 웹페이지를 출력하는 알고리즘에 대해 제안합니다.

페이지랭크 알고리즘의 핵심 아이디어는 **투표**입니다. 투표를 통해 사용자 키워드와 관련성이 높고 신뢰할 수 있는 웹페이지를 찾게 됩니다. 투표가 이뤄지는 방식은 웹페이지(노드)가 다른 웹페이지(노드)로의 방향 하이퍼링크(간선)를 가지게 되면 투표했다고 볼 수 있습니다. 즉, 들어오는 간선이 많을 수록 신뢰할 수 있다는 의미를 가지게 됩니다. 예를 들어, 사람들은 많이 인용된 논문을 보다 신뢰하는 경향이 있습니다.

하지만 들어오는 간선의 수만으로 해당 웹페이지의 신뢰도를 단순하게 판단할 수 없습니다. 악의적인 목적으로 간선의 수를 임의로 늘릴 수 있기 때문입니다.

페이지링크에서는 이러한 단점을 보완하기 위해서 **가중 투표** 를 적용합니다. 관련성이 높고 신뢰할 수 있는 웹사이트의 투표를 더 중요하게 간주하고 그렇지 않은 웹사이트의 투표의 가중치를 낮춰 합리적인 투표 결과를 유도합니다.

**투표 관점**

측정하려는 웹페이지의 관련성 및 신뢰도를 **페이지랭크 점수**라고 합니다. 각 웹페이지는 각각의 나가는 이웃에게 다음과 가중치로 투표를 진행합니다.

$$\frac {자신의 페이지랭크 점수}{나가는 이웃의 수}$$

아래 예시에서 웹페이지 j는 웹페이지 x, y, z에게 각각 $\frac {r_{j}}{3}$ 만큼의 가중치로 투표를 진행합니다. 여기서 $r_{j}$는 웹페이지 j의 페이지랭크 점수를 의미합니다.

<center>
<image src = https://user-images.githubusercontent.com/48677363/109111174-c7b2d200-777b-11eb-8ca0-074ca3fdd1e4.png width = 200>
</center>

웹페이지의 페이지랭크 점수는 해당 웹페이지가 받은 가중치 합으로 정의되기에 $r_{j}$를 $r_{j} = r_{i} / 3 + r_{k} / 4$ 로  계산할 수 있습니다. 그리고 페이지랭크 점수를 다음과 같이 정의할 수 있습니다.

$$r_{j} = \sum_{i\in N_{in}(j)} \frac {r_{i}}{d_{out}(i)}$$

**임의 보행(Random Walk) 관점**

웹을 이동하는 대상이라고 가정한다면 현재 웹페이지와 연결되어 있는 다른 웹페이지를 균일한 확률로 이동하게 됩니다.

t번째 방문한 웹페이지가 웹페이지 i일 확률을 $p_{i}(t)$라고 한다면 $p(t)$의 길이는 웹페이지 수(노드의 수)와 같은 확률분포 벡터가 됩니다. 그렇다면 t+1번째 방문한 웹페이지 j일 확률을 다음과 같이 정의할 수 있습니다.

$$p_{j}(t+1) = \sum_{i\in N_{in}(j)} \frac {p_{i}(t)}{d_{out}(i)}$$

웹을 이동하는 행위를 무한히 반복하게 된다면, 즉 t가 무한히 증가하면 확률 분포 $p(t)$는 정상 분포(Stationary Distribution)으로 수렴하게 되며 위 식은 아래 식과 동일하게 됩니다.

$$p_{j} = \sum_{i\in N_{in}(j)} \frac {p_{i}}{d_{out}(i)}$$

이렇게 페이지랭크 점수를 구하는 **투표** 관점과 **임의 보행** 관점은 결과적으로 동일한 수식을 가지게 됩니다.

#### 3) 페이지랭크의 계산

페이지랭크 점수의 계산에는 **반복곱, Power Iteration** 을 사용합니다.

- 각 웹페이지 i의 페이지랭크 점수 $r_{i}^{(0)}$ 를 동일하게 $\frac {1}{웹페이지의 수}$로 초기화함
- $r_{j}^{t+1} = \sum_{i\in N_{in}(j)} \frac {r_{i}(t)}{d_{out}(i)}$ 를 이용하여 각 웹페이지의 페이지랭크 점수를 갱신함
- 페이지랭크 점수가 수렴하게 되면 종류하고 그렇지 않으면 두번째 과정을 반복함

<center>
<image src = https://user-images.githubusercontent.com/48677363/109149703-483cf700-77ab-11eb-94b6-b55797938b80.png width = 500>
</center>

위 과정을 보다 자세하게 설명하면 각 페이지랭크 점수를 동일하게 1/3으로 초기화하게 됩니다. 그 이후로 2번 과정을 반복하게 되면서 t번째 페이지랭크 점수와 t+1번째 페이지랭크 점수가 동일(수렴)하게 되면 반복 과정을 멈추게 됩니다.

그러나 반복곡 과정에서 발생하는 **2가지 문제점**이 있습니다.

- 반복곱이 항상 수렴하는 것을 보장할 수 있는가?
- 반봅곱의 결과가 항상 합리적인 점수로 수렴하는 것을 보장할 수 있는가?

먼저 첫번째 질문에 대한 답변은 **스파이더 트랩**에 의해 항상 만족할 수 없습니다. 스파이더 트랩은 들어오는 간선은 있지만 나가는 간선은 없는 정점 집합을 의미하며 해당 그림에서는 b와 c의 정점 집합의 경우 들어오는 간선은 있지만 나가는 간선은 없는 것을 볼 수 있습니다.

<image src = https://user-images.githubusercontent.com/48677363/109153256-0498bc00-77b0-11eb-8b7f-f4e85c173ddc.png width = 220>

두번째 질문에 답변은 **막다른 정점**에 의해 항상 만족할 수 없습니다. 막다른 정점은 들어오는 간선은 있지만 나가는 간선은 없는 것을 의미하며, 해당 그림에서는 b가 막다른 정점에 해당합니다.

<image src = https://user-images.githubusercontent.com/48677363/109156963-d2d62400-77b4-11eb-86c8-a58f8f748bf9.png width = 150>

**순간이동, Teleport**

위 두 문제를 해결하기 위해서 **순간이동, Teleport** 기법을 도입합니다.

(1) 현재 웹페이지에 하이퍼링크가 없다면, 임의의 웹페이지로 순간이동 합니다
(2) 현재 웹페이지에 하이퍼링크가 있다면, 앞면이 나올 확률이 𝛼인 동전을 던집니다
(3) 앞면이라면, 하이퍼링크 중 하나를 균일한 확률로 선택해 클릭합니다
(4) 뒷면이라면, 임의의 웹페이지로 순간이동 합니다

임의의 웹페이지는 전체 웹피이지들 중 균일확률로 선택하게 되면 순간이동 기법으로 스파이더 트랩이나 막다른 정점을 마주치는 경우가 사라지게 됩니다. 이 때, 𝛼를 감폭 비율(Damping Factor)이라고 부르며 보통 0.8 정도를 사용합니다.

순간이동 기법을 페이지랭크 점수 계산에 도입하게 되면 다음과 같이 계산식이 변경됩니다.

- 각 막다른 정점에서 임의의 다른 정점으로 가는 간선을 추가함
- 변경된 수식을 사용하여 반복곱을 수행함

$$r_{j} = \sum_{i\in N_{in}(j)} \frac {r_{i}}{d_{out}(i)} + (1-a)\frac {1}{|V|}$$

이 때, $|V|$는 전체 웹페이지의 수를 의미합니다. 식의 우항은 하이퍼링크를 따라 정점 j에 도착할 확률을 의미하며 좌항은 순간이동을 통해 정점 j에 도착할 확률을 의미합니다.

---------

### 2. 바이럴 마케팅에서의 그래프 활용

복잡계에는 다양한 종류의 전파가 존재합니다. 예를 들어, 아이스 버킷 챌린지와 같은 행동의 전파 또는 코로나 바이러스와 같은 질병의 전파 등 다양한 방식의 전파가 존재함을 알 수 있습니다.

이번 강의에서는 전파, Influence를 모델링할 수 있는 간단한 수학적 모형들과 주어진 그래프와 규칙에서 전파를 최댜화하는 전파 최대화 문제에 대해서 배웁니다. 어떤 식으로 전파를 모델링할 수 있는 지, 전파가 단계별로 이루어지는 과정에 대해 다루게 됩니다.

#### 1) 그래프를 통한 전파

- **정보의 전파**: 온라인 소셜 네트워크, SNS를 통해 다양한 정보가 전파됩니다.

- **행동의 전파**: 아이스버킷 챌린지와 같은 행동 또한 전파되기도 합니다.

- **고장의 전파**: 컴퓨터 네트워크에서의 일부 장비의 고장이 전파되어 전체 네트워크를 마비시킬 수 있습니다. 

- **질병의 전파**: 코로나 바이러스, 메르스, 사스 등은 전염병으로 빠르게 전파되는 특징을 가지고 있습니다.

그래프를 통해 전파되는 유형은 매우 다양하지만 전파 과정 또한 매우 다양하며 복잡합니다. 이러한 전파 과정을 체계적으로 이해하고 대처하기 위해서는 **수학적 모형화**가 필요합니다.

#### 2) 전파 모형

**의사결정 기반의 전파 모형**

의사결정 기반 전파 모형은 주변 사람들의 의사결정을 고려하여 본인의 의사결정을 내리게 됩니다. 가장 간단한 형태의 의사결정 기반의 전파 모형으로는 **선형 임계치 모형(Linear Threshold Model)**이 있습니다.

선형 임계치 모형에서는 연결되어 있는 이웃의 의사결정을 기반하여 설정된 임계치에 따라 해당 정점의 의사결정을 내릴 수 있게 됩니다. 다음과 같이 이웃이 존재할 때, 이웃이 빨간색(a)일 확률이 $p$라면, 이웃이 파란색(b)일 확률은 $1-p$ 확률을 가지게 됩니다. 해당 정점이 다른 두 역할에 대한 의사결정을 하기 위해서는 $a * p$ 와 $b * (1-p)$ 라는 이웃의 의사결정에 기반해야합니다.

즉, 해당 정점이 빨간색이 되기 위해서는 $a * p > b * (1-p)$가 만족되어야 하며 $p$ 에 대해 $p > \frac {b}{a+b}$ 다음과 같이 정리됩니다. 결론적으로 빨간색이 되기 위해서 $\frac {b}{a+b}$라는 임계치 $q$ 를 초과해야하는 조건이 부여됩니다.

<center>
<image src = https://user-images.githubusercontent.com/48677363/109412161-b838c080-79e9-11eb-9042-eae60298bb88.png width = 400>
</center>

의사결정 기반 전파 모형에서 의사결정이 이뤄지는 과정에 대해 보다 구체적으로 알아볼 수 있습니다.

- 먼저 모든 정점이 파란색(b)인 그래프에서 정점 𝑢와 𝑣가 빨간색으로 감염되는 시드 집합(Seed Set)이 형성됩니다.
- 임계치 $q$가 55%라고 주어졌을 때, 정점 𝑢와 𝑣의 의사결정을 기반으로 이웃들 또한 다른 의사결정을 내리게 됩니다.
- 정점 𝑢와 𝑣의 이웃 또한 이웃이 존재하기 때문에 반복적으로 새로운 의사결정을 내리게 되며 변화하기도 유지하기도 합니다.
- 의사결정이 바뀌지 않은 정점을 보게 되면 임계치 50%임을 알 수 있습니다.

![image](https://user-images.githubusercontent.com/48677363/109412676-b0c6e680-79ec-11eb-9bcf-4dd3c2eebfb3.png)

**확률적 전파 모형**

의사결정이 존재하지 않는 복잡계에서는 의사결정 기반 모형은 적합하지 않습니다. 예를 들어, 코로나 바이러스의 전파 과정에서는 의사결정에 대한 결정권이 존재하지 않으며 바이러스의 전파 과정은 확률적 과정이기 때문에 확률적 전파 모형을 고려해야합니다. 가장 간단한 형태의 확률적 전파 모형은 **독립적 전파 모형(Independent Cascade Model)**이 있습니다.

독립적 전파 모형에서는 방향성과 가중치가 존재하는 그래프를 가정합니다. 각 간선 (𝑢, 𝑣)의 가중치 $𝑝_{𝑢𝑣}$는 𝑢가 𝑣에 전파할 확률을 의미합니다. 즉, 각 정점 𝑣가 이웃 정점인 𝑣에 $𝑝_{𝑢𝑣}$ 확률로 전파합니다.

이 때, 서로 다른 이웃이 전파되는 확률은 독립적입니다. 

- 정점 𝑢에 대한 $𝑝_{𝑢𝑣}$와 $𝑝_{𝑢𝑤}$ 는 독립적입니다.
- 정점 𝑢와 𝑤에 대해 $𝑝_{𝑢𝑣}$와 $𝑝_{𝑤𝑣}$ 는 독립적입니다.

<center>
<image src = https://user-images.githubusercontent.com/48677363/109413296-f9cc6a00-79ef-11eb-80e3-8194dc981035.png width = 250>
</center>

최초 전파가 가능한 집합인 시드 집합이 존재할 때, 각 시드 집합의 정점은 독립적으로 이웃 정점에게 $𝑝_{𝑢𝑣}$ 확률로 전파를 진행합니다. 전파 과정이 반복적으로 이뤄지게 되면서 전파가 더 이상 이뤄지지 않을 때, 전파 과정이 종료됩니다.

#### 3) 바이럴 마케팅과 전파 최대화 문제

바이럴 마케팅이란 소비자들로 하여금 상품에 대한 긍정적인 입소문을 내게 하는 기법입니다. 바이럴 마케팅을 효과적으로 진행하기 위해서는 **소문의 시작점**이 중요한 역할을 하게 됩니다. 시작점에 따라 **입소문이 전파되는 범위**가 달라지기 때문입니다. SNS 상에서 소셜 인플루언서를 활용하여 바이럴 마케팅을 하는 이유에 대해서 생각해 볼 수 있습니다.

이러한 바이럴 마케팅의 특징을 고려해보면 위에서 살펴본 전파 모형과 굉장히 유사한 특징을 가지고 있습니다. 앞서 다룬 선형 임계치 모형의 예시에서 시드 집합으로 𝑢와 𝑣가 선택되었을 때, 총 9명의 정점이 전파되는 결곽가 나타났습니다. 하지만 만약 시드 집합으로 𝑥와 𝑦를 선택했더라면, 최종적으로 어떠한 전파 과정도 발생하지 않는 결과를 얻게 됩니다.

<image src = https://user-images.githubusercontent.com/48677363/109413692-081b8580-79f2-11eb-8053-bbf86d2ed01b.png width = 400>

즉, 시드 집합에 따라 전파 크기가 변화하기 때문에 그래프, 전파 모형 그리고 시드 집합의 크기가 주어졌을 때, 전파를 최대화하는 시드 집합을 찾아야 합니다. 이를 **전파 최대화, Influence Maximization** 문제라고 합니다.

전파 최대화 문제는 방대한 그래프에서 가장 영향력있는 시드 집합을 찾아내는 문제입니다. 하지만 그래프에서 V개의 정점과 시드 집합의 크기가 K로 주어지게 되더라도 서로 다른 시드 집합의 경우의 수는 $_{V}\mathrm{C}_{k}$ 가 됩니다. 이론적으로 많은 전파 모형에서 전파 최대화 문제는 NP-hard가 되기 때문에 모든 경우를 고려한 최고의 시드 집합을 찾는 알고리즘을 사용할 수는 없습니다.

**정점 중심성 휴리스틱**

대표적인 휴리스틱으로 정점의 중심성을 사용합니다. 시드 집합의 크기가 k개일 때, 정점의 중심성이 높은 순으로 k개의 정점을 선택하는 방법입니다. 정점의 중심성을 측정하는 방법으로는 페이지랭크 점수, 연결 중심성, 근접 중심성, 매개 중심성 등이 있습니다. 합리적인 방법이지만, 최고의 시드 집합을 찾는 다는 보장은 없습니다.

**탐욕 알고리즘**

탐욕 알고리즘은 시드 집합의 원소를 한번에 한 명씩 선택합니다. 즉 시드 집합의 크기가 k개로 주어졌을 때, 1 ~ k번째의 각 step에서 가장 전파를 최대화하는 시드 집합을 구성해 나갑니다. 예를 들어 V개의 정점인 존재하는 그래프에서 1 step에서는 1개의 정점에서 전파를 최대화하는 하나의 정점을 선택하고 2 step에서는 1 step의 결과와 합쳐졌을 때 전파를 최대화하는 정점을 선택함으로서 최종적으로 k개의 정점을 선택하게 됩니다.

탐욕 알고리즘은 step별 독립적으로 진행되기 때문에 최초 전파자 간의 조합의 효과를 고려하지 않고 근시안적으로 최초 전파자를 선택하는 과정을 반복합니다. 그러므로 탐욕 알고리즘 또한 최고의 시드 집합을 찾는 것을 보장하지는 않지만 독립 전파 모형의 경우 이론적으로 정확도가 일부 보장됩니다.

$탐욕 알고리즘의 시드 집합 전파 (평균) 크기 > 0.632 * 최고 시드 집합 전파 (평균 크기)$

