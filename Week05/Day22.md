# Week05 - Graph

## [Day 22] - 페이지랭크 & 전파 모델

### 1. 검색 엔진에서의 그래프 활용

이번 강의에서는 페이지랭크, PageRank 알고리즘에 대해 배웁니다.

인터넷에는 인터넷 페이지가 무수히 많습니다. 그리고 네이버, 구글 등의 검색엔진에서는 키워드에 대한 적합한 결과를 페이지로 보여주게 됩니다. 검색엔진이 결과를 보여주고 우선순위를 결정하는 방법은 단순하지 않습니다.

이번 강의에서는 구굴의 검색 알고리즘인 페이지랭크 알고리즘을 배우게 됩니다. 그리고 페이지랭크 알고리즘에서 발생할 수 있는 문제점과 이를 해결할 수 있는 알고리즘을 배우게 됩니다.

#### 1) 웹과 그래프

웹은 **웹페이지**와 **하이퍼링크**로 구성된 **거대한 방향 그래프**입니다. 즉, 웹페이지는 정점에 해당하며 웹페이지가 포함하는 하이퍼링크는 해당 웹페이지에서 다음 웹페이지로 향하는 간선에 해당합니다. 이 때, 웹페이지는 추가적으로 키워드 정보를 포함하고 있습니다.

웹의 규모가 커짐에 따라 사용자에게 웹페이지를 보여주는 방식의 변화가 필요했습니다. 첫번째 방법으로는 웹페이지의 디렉토리를 설정하여 카테고리화로 정리하는 것이었습니다. 하지만 웹페이지 자체가 무한정으로 증가하다보니 카테고리 구분이 모호한 경우가 발생하였고 단순히 분류하는 문제가 효율성을 불러올 수 없었습니다. 두번째는 키워드에 따른 웹페이지를 출력하는 방법입니다. 사용자가 입력한 키워드에 해당하는 결과물을 보여주는 방법이지만 페이지 노출을 위해 악의적으로 키워드를 삽입한 경우에 예상치 못한 결과가 나올 수 있습니다.

그렇기 때문에 웹의 규모가 계속해서 폭증하고 있는 상황에서, 사용자 키워드와 관련성이 높고 신뢰할 수 있는 웹페이지를 찾는 알고리즘이 요구되었습니다.

#### 2) 페이지랭크

구글의 창업자인 래리 페이지와 세르게이 브린은 ***The PageRank Citation Ranking: Bringing Order to the Web*** 이라는 논문을 통해 사용자의 키워드와 관련성이 높고 신뢰할 수 있는 웹페이지를 출력하는 알고리즘에 대해 제안합니다.

페이지랭크 알고리즘의 핵심 아이디어는 **투표**입니다. 투표를 통해 사용자 키워드와 관련성이 높고 신뢰할 수 있는 웹페이지를 찾게 됩니다. 투표가 이뤄지는 방식은 웹페이지(노드)가 다른 웹페이지(노드)로의 방향 하이퍼링크(간선)를 가지게 되면 투표했다고 볼 수 있습니다. 즉, 들어오는 간선이 많을 수록 신뢰할 수 있다는 의미를 가지게 됩니다. 예를 들어, 사람들은 많이 인용된 논문을 보다 신뢰하는 경향이 있습니다.

하지만 들어오는 간선의 수만으로 해당 웹페이지의 신뢰도를 단순하게 판단할 수 없습니다. 악의적인 목적으로 간선의 수를 임의로 늘릴 수 있기 때문입니다.

페이지링크에서는 이러한 단점을 보완하기 위해서 **가중 투표** 를 적용합니다. 관련성이 높고 신뢰할 수 있는 웹사이트의 투표를 더 중요하게 간주하고 그렇지 않은 웹사이트의 투표의 가중치를 낮춰 합리적인 투표 결과를 유도합니다.

**투표 관점**

측정하려는 웹페이지의 관련성 및 신뢰도를 **페이지랭크 점수**라고 합니다. 각 웹페이지는 각각의 나가는 이웃에게 다음과 가중치로 투표를 진행합니다.

$$\frac {자신의 페이지랭크 점수}{나가는 이웃의 수}$$

아래 예시에서 웹페이지 j는 웹페이지 x, y, z에게 각각 $\frac {r_{j}}{3}$ 만큼의 가중치로 투표를 진행합니다. 여기서 $r_{j}$는 웹페이지 j의 페이지랭크 점수를 의미합니다.

<center>
<image src = https://user-images.githubusercontent.com/48677363/109111174-c7b2d200-777b-11eb-8ca0-074ca3fdd1e4.png width = 200>
</center>

웹페이지의 페이지랭크 점수는 해당 웹페이지가 받은 가중치 합으로 정의되기에 $r_{j}$를 $r_{j} = r_{i} / 3 + r_{k} / 4$ 로  계산할 수 있습니다. 그리고 페이지랭크 점수를 다음과 같이 정의할 수 있습니다.

$$r_{j} = \sum_{i\in N_{in}(j)} \frac {r_{i}}{d_{out}(i)}$$

**임의 보행(Random Walk) 관점**

웹을 이동하는 대상이라고 가정한다면 현재 웹페이지와 연결되어 있는 다른 웹페이지를 균일한 확률로 이동하게 됩니다.

t번째 방문한 웹페이지가 웹페이지 i일 확률을 $p_{i}(t)$라고 한다면 $p(t)$의 길이는 웹페이지 수(노드의 수)와 같은 확률분포 벡터가 됩니다. 그렇다면 t+1번째 방문한 웹페이지 j일 확률을 다음과 같이 정의할 수 있습니다.

$$p_{j}(t+1) = \sum_{i\in N_{in}(j)} \frac {p_{i}(t)}{d_{out}(i)}$$

웹을 이동하는 행위를 무한히 반복하게 된다면, 즉 t가 무한히 증가하면 확률 분포 $p(t)$는 정상 분포(Stationary Distribution)으로 수렴하게 되며 위 식은 아래 식과 동일하게 됩니다.

$$p_{j} = \sum_{i\in N_{in}(j)} \frac {p_{i}}{d_{out}(i)}$$

이렇게 페이지랭크 점수를 구하는 **투표** 관점과 **임의 보행** 관점은 결과적으로 동일한 수식을 가지게 됩니다.

#### 3) 페이지랭크의 계산

페이지랭크 점수의 계산에는 **반복곱, Power Iteration** 을 사용합니다.

- 각 웹페이지 i의 페이지랭크 점수 $r_{i}^{(0)}$ 를 동일하게 $\frac {1}{웹페이지의 수}$로 초기화함
- $r_{j}^{t+1} = \sum_{i\in N_{in}(j)} \frac {r_{i}(t)}{d_{out}(i)}$ 를 이용하여 각 웹페이지의 페이지랭크 점수를 갱신함
- 페이지랭크 점수가 수렴하게 되면 종류하고 그렇지 않으면 두번째 과정을 반복함

<center>
<image src = https://user-images.githubusercontent.com/48677363/109149703-483cf700-77ab-11eb-94b6-b55797938b80.png width = 500>
</center>

위 과정을 보다 자세하게 설명하면 각 페이지랭크 점수를 동일하게 1/3으로 초기화하게 됩니다. 그 이후로 2번 과정을 반복하게 되면서 t번째 페이지랭크 점수와 t+1번째 페이지랭크 점수가 동일(수렴)하게 되면 반복 과정을 멈추게 됩니다.

그러나 반복곡 과정에서 발생하는 **2가지 문제점**이 있습니다.

- 반복곱이 항상 수렴하는 것을 보장할 수 있는가?
- 반봅곱의 결과가 항상 합리적인 점수로 수렴하는 것을 보장할 수 있는가?

먼저 첫번째 질문에 대한 답변은 **스파이더 트랩**에 의해 항상 만족할 수 없습니다. 스파이더 트랩은 들어오는 간선은 있지만 나가는 간선은 없는 정점 집합을 의미하며 해당 그림에서는 b와 c의 정점 집합의 경우 들어오는 간선은 있지만 나가는 간선은 없는 것을 볼 수 있습니다.

<image src = https://user-images.githubusercontent.com/48677363/109153256-0498bc00-77b0-11eb-8b7f-f4e85c173ddc.png width = 220>

두번째 질문에 답변은 **막다른 정점**에 의해 항상 만족할 수 없습니다. 막다른 정점은 들어오는 간선은 있지만 나가는 간선은 없는 것을 의미하며, 해당 그림에서는 b가 막다른 정점에 해당합니다.

<image src = https://user-images.githubusercontent.com/48677363/109156963-d2d62400-77b4-11eb-86c8-a58f8f748bf9.png width = 150>

**순간이동, Teleport**

위 두 문제를 해결하기 위해서 **순간이동, Teleport** 기법을 도입합니다.

(1) 현재 웹페이지에 하이퍼링크가 없다면, 임의의 웹페이지로 순간이동 합니다
(2) 현재 웹페이지에 하이퍼링크가 있다면, 앞면이 나올 확률이 𝛼인 동전을 던집니다
(3) 앞면이라면, 하이퍼링크 중 하나를 균일한 확률로 선택해 클릭합니다
(4) 뒷면이라면, 임의의 웹페이지로 순간이동 합니다

임의의 웹페이지는 전체 웹피이지들 중 균일확률로 선택하게 되면 순간이동 기법으로 스파이더 트랩이나 막다른 정점을 마주치는 경우가 사라지게 됩니다. 이 때, 𝛼를 감폭 비율(Damping Factor)이라고 부르며 보통 0.8 정도를 사용합니다.

순간이동 기법을 페이지랭크 점수 계산에 도입하게 되면 다음과 같이 계산식이 변경됩니다.

- 각 막다른 정점에서 임의의 다른 정점으로 가는 간선을 추가함
- 변경된 수식을 사용하여 반복곱을 수행함

$$r_{j} = \sum_{i\in N_{in}(j)} \frac {r_{i}}{d_{out}(i)} + (1-a)\frac {1}{|V|}$$

이 때, $|V|$는 전체 웹페이지의 수를 의미합니다. 식의 우항은 하이퍼링크를 따라 정점 j에 도착할 확률을 의미하며 좌항은 순간이동을 통해 정점 j에 도착할 확률을 의미합니다.

---------

### 2. 바이럴 마케팅에서의 그래프 활용

정보의 전파는 어떻게 일어나는 걸까요? 우리가 살고 있는 복잡계에는 아이스 버킷 챌린지와 같은 행동의 전파나 코로나-19와 같은 질병의 전파 등 다양한 방식의 전파가 있습니다. 이번 강의에서는 전파(Influence)를 모델링할 수 있는 간단한 수학적 모형들과 주어진 그래프와 규칙에서 전파를 최대화하는 전파 최대화 문제에 대해서 배웁니다. 어떤 식으로 전파를 모델링할 수 있는 지, 전파가 단계별로 어떻게 이루어지는 지 집중하면서 강의를 들어봅시다!

