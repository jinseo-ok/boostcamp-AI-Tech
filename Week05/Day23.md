# Week05 - Graph

## [Day 23] - 군집 탐색 & 추천시스템 I

### 1. 그래프 구조 분석 방법

이번 강의에서는 그래프에서 군집, Community가 무엇인지 배우고, 군집에 대한 해석과 군집을 탐색하는 방법에 대해 배웁니다.

복잡계에서는 다양한 종류의 군집을 볼 수 있습니다. 인간 관계 사이에서, 화학 물질 내부에서 등 어디서나 군집을 발견할 수 있습니다. 그러므로 그래프 데이터에서 군집을 탐색하고 분석함으로써, 주어진 그래프에 대한 특징과 해석에 용이하게 활용할 수 있습니다.

#### 1) 군집 구조와 군집 탐색 문제

그래프에서 **군집, Community** 이란 다음 조건을 만족하는 정점의 집합입니다. 모호한 표현이 사용되었기에 수학적으로 약속된 정의라고 할수는 없지만 시각적으로 표현되었을 때, 군집의 의미를 파악할 수 있습니다.

- 집합에 속하는 정점 사이에는 많은 간선이 존재함
- 집합에 속하는 정점과 그렇지 않은 정점 사이에는 적은 수의 간선이 존재함

<image src = https://user-images.githubusercontent.com/48677363/109461943-35297000-7aa6-11eb-99e8-03358275f66b.png width = 500>

그래프에 존재하는 군집을 구분하는 문제를 **군집 탐색, Community Detection** 이라고 합니다.

보통은 각 정점이 한 개의 군집에 속하도록 군집을 구분하기 때문에 비지도 기계학습 문제인 클러스터링, Clustering과 상당히 유사합니다. 성공적으로 군집을 탐색하고 형성하기 위해서는 배치 모형과의 비교를 통해 이뤄집니다.

#### 2) 군집 구조의 통계적 유의성과 군집성

배치 모형과의 비교를 통해 군집 구조의 통계적 유의성이라는 **군집성**을 측정하게 됩니다.

**배치 모형, Configuration Model**

주어진 그래프에 대한 배치 모형은 **각 정점의 연결성(Degree)을 보존한 상태에서 간선들을 무작위로 재배치**하여 얻을 수 있는 그래프를 의미합니다. 연결성을 보존된 상태이기 때문에, 배치 모형에서 임의의 두 정점 𝑖와 𝑗 간의 간선이 존재할 확률은 두 정점의 연결성에 비례합니다.

<image src = https://user-images.githubusercontent.com/48677363/109462688-3ad38580-7aa7-11eb-94d2-e7e0884d8f06.png width = 250>

**군집성, Modularity**

군집 탐색의 성공 여부를 판단하기 위해서 군집성을 측정하게 됩니다. 주어진 그래프에서 형성된 군집들의 집합을 배치 모형과 비교함으로써 각 군집의 성질을 만족함을 판단하게 됩니다. 군집성은 군집 내부의 간선 개수를 그래프와 배치모형과 비교함으로써 계산할 수 있습니다.

여기서 배치모형의 기댓값을 사용하는 이유는, 배치모형 자체가 무작위로 재배치되는 특성을 가지고 있기 때문입니다. 즉, 배치 모형과 비교했을 때, 그래프에서 군집 내부 간선의 수가 월등이 많을수록 성공적인 순집 탐색입니다. 개인적으로 느낀 이유는 배치모형 자체는 무작위로 선발된 기댓값으로 모집단의 평균으로 가정할 수 있기 때문에 평균과의 차이가 클수록 해당 군집이 보유하고 있는 특성이 반영되었다고 생각합니다.

<image src = https://user-images.githubusercontent.com/48677363/109463652-beda3d00-7aa8-11eb-96e8-ce22f90c344d.png width = 700>
<br>
<br>

결론적으로 군집성은 **무작위로 연결된 배치 모형과의 비교를 통해 통계적 유의성**을 판단합니다. 군집성은 정규화는 통해 항상 -1 ~ +1 사이의 값을 가지게 되며 0.3 ~ 0.7 정도의 값을 가지게 될 때, 통계적으로 유의미한 군집이라고 할 수 있습니다.

#### 3) 군집 탐색 알고리즘

**Girvan-Newman 알고리즘**

(1) 주어진 전체 그래프의 구조를 기반으로 알고리즘 과정이 시작됩니다.
(2) 매개 중심성이 높은 순서로 간선을 제거하는 과정을 반복하며, 군집성의 변화를 기록합니다.
(3) 군집성이 가장 큰 시점을 해당 그래프의 군집 결과로 출력합니다.
(4) 이 때, 서로 연결된 정점들을 하나의 군집으로 간주합니다.
(5) 전체 그래프에서 시작해서 점점 작은 단위로 향하는 하향식, Top-Down 방법입니다.

**Girvan-Newman 알고리즘**은 대표적인 하향식(Top-Down) 군집 탐색 알고리즘입니다. 주어진 그래프 전체에서 탐색을 시작하면서 군집들이 서로 분리되도록 간선을 순차적으로 제거합니다. 이 때, 간선을 제거함으로써 군집이 형성되기 때문에 서로 다른 군집을 연결하는 다리(Bridge) 역할의 간선을 제거할 간선으로 선택할 수 있습니다.

<image src = https://user-images.githubusercontent.com/48677363/109464317-d7972280-7aa9-11eb-8a7a-8ca1eba1ae3d.png width = 400>

<br>

서로 다른 군집을 연결하는 다리 역할의 간선을 찾는 방법으로는 **간선의 매개 중심성, Betweenness Centrality** 를 통해 해당 간선이 정점 간의 최단 경로에 놓이는 횟수를 측정하는 방법이 있습니다.

정점 𝑖로 부터 𝑗로의 최단 경로 수를 $\sigma_{𝑖,𝑗}$ , 그 중 간선 (𝑥,𝑦)를 포함한 것을 $\sigma_{𝑖,𝑗}(𝑥,𝑦)$ 라고 한다면 간선 (𝑥,𝑦)의 매개 중심성은 다음과 같이 표현할 수 있습니다.

$$\sum_{i < j} \frac {\sigma_{𝑖,𝑗}(𝑥,𝑦)}{\sigma_{𝑖,𝑗}}$$

**Girvan-Newman 알고리즘**은 매개 중심성이 높은 간선을 순차적으로 제거합니다. 간선이 제거될 때마다, 매개 중심성을 다시 계산하여 반복 제거하게 됩니다. 간선이 모두 제거될때까지 과정을 반복할 수 있지만 해당 알고리즘은 간선의 제거 정도에 따라서 다른 입도(Granularity)의 군집 구조가 나타납니다.

<image src = https://user-images.githubusercontent.com/48677363/109466799-a3bdfc00-7aad-11eb-998d-a846fb128d9b.png width = 500>

<br>

가장 올바르게?정확하게? 군집을 구분하기 위해서 간선의 제거를 위한 반복 과정을 **군집성**을 기준으로 할 수 있습니다. 즉, 군집성이 최대가 되는 지점까지 간선을 제거하는 과정을 반복합니다. 단, 현재의 연결 요소들을 군집으로 가정하되, 입력 그래프에서 군집성을 계산합니다.

<center>
<image src = https://user-images.githubusercontent.com/48677363/109468080-71ad9980-7aaf-11eb-9372-b3a5be526a45.png width = 400>
</center>

**Louvain 알고리즘**

(1) 주어진 전체 그래프의 개별 정점으로 알고리즘 과정이 시작됩니다.
(2) 개별 정점으로 구성된 크기 1의 군집으로부터 시작합니다.
(3) 각 정점 𝑢를 기존 혹은 새로운 군집으로 이동합니다. 이 때, 군집성이 최대화되도록 군집을 결정합니다.
(4) 더 이상 군집성이 증가하지 않을 때까지 3번 과정을 반복합니다.
(5) 각 군집을 하나의 정점으로 하는 군집 레벨의 그래프를 얻은 뒤 4번 과정을 수행합니다.
(6) 최종적으로 모든 정점이 하나의 군집으로 형성될때까지 과정을 반복합니다.

**Louvain 알고리즘**은 대표적인 상향식(Bottom-Up) 군집 탐색 알고리즘입니다. 주어진 그래프의 각 정점이 하나의 군집을 형성한다고 가정하며 정점 병합을 통해 최종 군집을 형성하게 됩니다.

<image src = https://user-images.githubusercontent.com/48677363/109469670-af132680-7ab1-11eb-9c82-1f71498e6a73.png width = 400>

각 정점으로만 존재하는 상황에서 군집을 형성하기 위해 정점 병합 또한 **군집성**을 기준으로 이뤄집니다. 

#### 4) 중첩이 존재하는 군집 탐색

실제 그래프의 군집들은 중첩되어 있는 경우가 대부분입니다. 예를 들어, 소셜 네트워크에서의 개인은 여러 사회적 역할을 수행합니다. 그 결과 여러 군집에 속하게 됩니다. 앞서 배운 Girvan-Newman 알고리즘과 Luvain 알고리즘은 군집 간의 중첩이 없다고 가정하여 각 정점 당 하나의 군집으로 매핑됩니다.

중첩을 가정하는 군집 탐색을 위해서는 **중첩 군집 모형**을 가정합니다.

- 각 정점은 여러 개의 군집에 속할 수 있음
- 각 군집 𝐴에 대하여, 같은 군집에 속하는 두 정점은 $𝑃_𝐴$ 확률로 간선으로 직접 연결됨
- 두 정점이 여러 군집에 동시에 속할 경우, 간선 연결 확률은 독립적임
- 어느 군집에도 함께 속하지 않는 두 정점은 낮은 확률 𝜖으로 직접 연결됨

결론적으로 그래프가 주어진 상황에서는 군집이 주어지지 않습니다. 그렇기 때문에 중첩 군집 탐색은 주어진 그래프의 확률을 최대화하는 **중첩 군집 모형을 찾는 과정**입니다. 통계적으로 보게 되면, 최우도 추정치인 Maximum Likelihood Estimate를 찾는 과정입니다.
하지만 개별 정점들이 군집으로 형성되는 여부는 discrete(이산적)으로 결정되기 때문에 최적화된 중첩 군집 모형을 찾는 과정은 어렵습니다.

<image src = https://user-images.githubusercontent.com/48677363/109471600-4f6a4a80-7ab4-11eb-98dc-a1ca99096941.png width = 400>

중첩 군집 탐색을 용이하게 하기 위해서는 완화된 중첩 군집 모형을 사용합니다. 완화된 중첩 군집 모형에서는 각 정점이 각 군집에 속해 있는 정도를 실숫값으로 표현합니다. (개인적으로 이 실숫값을 softmax와 같은 확률로 이해하였습니다.)

즉, 기존 모형에서는 군집 여부가 (0, 1)로만 표현되었다면 실숫값으로 정도를 표현함으로써 경사하강법 등과 같은 최적화 도구를 보다 쉽게 적용할 수 있습니다. 

--------

### 2. 그래프 기반 추천시스템 I